import{M as V,d as L}from"./DeleteModal-550a5879.js";import{_ as U,o as d,c as n,b as t,k as a,v as u,F as y,h as w,g as E,l as I,m as T,r as _,a as f,p as C,t as g}from"./index-af92421e.js";import{p as $}from"./PaginationComponent-35f24f56.js";import{s as k}from"./statusStore-d902806f.js";import"./component-functions-d7e525bd.js";const{VITE_URL:D,VITE_PATH:A}={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"zack_p",BASE_URL:"/vue_week7_assignment/",MODE:"production",DEV:!1,PROD:!0},N={props:["product","isNew"],watch:{product(){this.tempProduct=this.product}},data(){return{Modal:{},tempProduct:{}}},mixins:[V],methods:{uploadFile(){const l=this.$refs.fileInput.files[0],e=new FormData;e.append("file-to-upload",l),this.$http.post(`${D}/api/${A}/admin/upload`,e).then(i=>{i.data.success&&(this.tempProduct.imageUrl=i.data.imageUrl)}).catch(i=>{alert(i.response.data.message)})}}},F={class:"modal fade",id:"exampleModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"Modal"},R={class:"modal-dialog modal-xl"},z={class:"modal-content border-0"},S={class:"modal-header bg-dark"},B={class:"modal-title fs-5 fw-bold",id:"exampleModalLabel"},H={key:0,class:"text-info"},O={key:1,class:"text-warning"},j=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),q={class:"modal-body"},G={class:"row"},J={class:"col-md-4"},K={class:"mb-3"},Q=t("label",{for:"photo",class:"form-label fs-5"},"輸入圖片網址",-1),W=["src"],X={class:"mb-3"},Y=t("label",{for:"customFile",class:"form-label"},"或 上傳圖片",-1),Z=t("i",{class:"fa-solid fa-camera-rotate fa-flip"},null,-1),tt=t("h2",{class:"fw-bold mb-3"},"多圖新增",-1),et={key:0},ot=["onUpdate:modelValue"],st=["src"],lt={key:0},it={key:1},dt={class:"col-md-8"},nt={class:"mb-3"},rt=t("label",{for:"title",class:"form-label"}," 標題 ",-1),ct={class:"row mb-3"},at={class:"col-md-6 mb-3"},ut=t("label",{for:"category",class:"form-label"},"分類",-1),pt={class:"col-md-6 mb-3"},mt=t("label",{for:"unit",class:"form-label"},"單位",-1),ht={class:"col-md-6 mb-3"},_t=t("label",{for:"origin_price",class:"form-label"},"原價",-1),ft={class:"col-md-6 mb-3"},gt=t("label",{for:"price",class:"form-label"},"售價",-1),bt=t("div",{class:"mb-3"},[t("hr")],-1),Pt={class:"mb-3"},vt=t("label",{for:"description",class:"form-label"},"產品描述",-1),yt={class:"mb-3"},Ut=t("label",{for:"content",class:"form-label"},"產品內容",-1),wt={class:"mb-3"},kt={class:"form-check"},Mt=t("label",{for:"enable",class:"form-check-label"}," 是否啟用 ",-1),xt={class:"modal-footer"},Vt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"取消",-1);function Lt(l,e,i,h,o,r){return d(),n("div",F,[t("div",R,[t("div",z,[t("div",S,[t("h1",B,[i.isNew?(d(),n("span",H,"新增產品")):(d(),n("span",O,"編輯產品"))]),j]),t("div",q,[t("div",G,[t("div",J,[t("div",K,[Q,a(t("input",{type:"text",class:"form-control",id:"photo","onUpdate:modelValue":e[0]||(e[0]=s=>o.tempProduct.imageUrl=s)},null,512),[[u,o.tempProduct.imageUrl]]),t("img",{src:o.tempProduct.imageUrl,alt:"",class:"img-fluid"},null,8,W)]),t("div",X,[Y,Z,t("input",{id:"customFile",type:"file",class:"form-control",ref:"fileInput",onChange:e[1]||(e[1]=(...s)=>r.uploadFile&&r.uploadFile(...s))},null,544)]),tt,Array.isArray(o.tempProduct.imagesUrl)?(d(),n("div",et,[(d(!0),n(y,null,w(o.tempProduct.imagesUrl,(s,m)=>(d(),n("div",{class:"mb-1",key:"images"+m},[a(t("input",{type:"text",class:"form-control","onUpdate:modelValue":v=>o.tempProduct.imagesUrl[m]=v},null,8,ot),[[u,o.tempProduct.imagesUrl[m]]]),t("img",{src:o.tempProduct.imagesUrl[m],alt:"",class:"img-fluid mb-2"},null,8,st)]))),128)),!o.tempProduct.imagesUrl.length||o.tempProduct.imagesUrl[o.tempProduct.imagesUrl.length-1]?(d(),n("div",lt,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm w-100",onClick:e[2]||(e[2]=s=>o.tempProduct.imagesUrl.push(""))},"新增圖片")])):(d(),n("div",it,[t("button",{type:"button",class:"btn btn-outline-danger btn-sm w-100",onClick:e[3]||(e[3]=s=>o.tempProduct.imagesUrl.pop())},"刪除圖片")]))])):E("",!0)]),t("div",dt,[t("div",nt,[rt,a(t("input",{type:"text",class:"form-control",placeholder:"必填標題",id:"title","onUpdate:modelValue":e[4]||(e[4]=s=>o.tempProduct.title=s)},null,512),[[u,o.tempProduct.title]])]),t("div",ct,[t("div",at,[ut,a(t("input",{type:"text",class:"form-control",id:"category",placeholder:"必填分類","onUpdate:modelValue":e[5]||(e[5]=s=>o.tempProduct.category=s)},null,512),[[u,o.tempProduct.category]])]),t("div",pt,[mt,a(t("input",{type:"text",class:"form-control",id:"unit",placeholder:"必填單位","onUpdate:modelValue":e[6]||(e[6]=s=>o.tempProduct.unit=s)},null,512),[[u,o.tempProduct.unit]])]),t("div",ht,[_t,a(t("input",{type:"number",class:"form-control",id:"origin_price",placeholder:"必填原價","onUpdate:modelValue":e[7]||(e[7]=s=>o.tempProduct.origin_price=s)},null,512),[[u,o.tempProduct.origin_price,void 0,{number:!0}]])]),t("div",ft,[gt,a(t("input",{type:"number",class:"form-control",id:"price",placeholder:"必填售價","onUpdate:modelValue":e[8]||(e[8]=s=>o.tempProduct.price=s)},null,512),[[u,o.tempProduct.price,void 0,{number:!0}]])])]),bt,t("div",Pt,[vt,a(t("textarea",{id:"description",cols:"2",class:"form-control","onUpdate:modelValue":e[9]||(e[9]=s=>o.tempProduct.description=s)},null,512),[[u,o.tempProduct.description]])]),t("div",yt,[Ut,a(t("textarea",{id:"content",cols:"2",class:"form-control","onUpdate:modelValue":e[10]||(e[10]=s=>o.tempProduct.content=s)},null,512),[[u,o.tempProduct.content]])]),t("div",wt,[t("div",kt,[a(t("input",{type:"checkbox",class:"form-check-input",id:"enable","onUpdate:modelValue":e[11]||(e[11]=s=>o.tempProduct.is_enabled=s),"true-value":1,"false-value":0},null,512),[[I,o.tempProduct.is_enabled]]),Mt])])])])]),t("div",xt,[Vt,t("button",{type:"button",class:"btn btn-primary",onClick:e[12]||(e[12]=s=>l.$emit("update-product",o.tempProduct))},"確定")])])])],512)}const Et=U(N,[["render",Lt]]),{VITE_URL:b,VITE_PATH:P}={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"zack_p",BASE_URL:"/vue_week7_assignment/",MODE:"production",DEV:!1,PROD:!0},p=k(),It={inject:["emitter"],data(){return{color:"purple",loader:"dots",products:[],isNew:!1,tempProduct:{imagesUrl:[]},page:{}}},computed:{...T(k,["isLoading"])},components:{productModal:Et,deleteProductModal:L,pagination:$},methods:{getProducts(l=1){p.isLoading=!0,this.$http.get(`${b}/api/${P}/admin/products/?page=${l}`).then(e=>{p.isLoading=!1,this.products=e.data.products,this.page=e.data.pagination}).catch(e=>{p.isLoading=!1,alert(e.response.data.message)})},openModal(l,e){l==="new"?(this.tempProduct={imagesUrl:[]},this.isNew=!0,this.$refs.productModal.show()):l==="edit"?(this.tempProduct={...e},this.isNew=!1,this.$refs.productModal.show()):l==="delete"&&(this.tempProduct={...e},this.$refs.deleteProductModal.show())},updateProduct(l){this.tempProduct=l;let e=`${b}/api/${P}/admin/product`,i="post";this.isNew||(e=`${b}/api/${P}/admin/product/${this.tempProduct.id}`,i="put"),p.isLoading=!0,this.$http[i](e,{data:this.tempProduct}).then(h=>{p.pushMessage({title:"更新成功"}),p.isLoading=!1,this.$refs.productModal.hide(),this.getProducts()}).catch(h=>{p.isLoading=!1,this.$refs.productModal.hide(),this.getProducts(),this.emitter.emit("push-message",{style:"danger",title:"更新失敗",content:h.response.data.message.join("、")})})},removeProduct(l){this.tempProduct=l;const e=`${b}/api/${P}/admin/product/${this.tempProduct.id}`;this.$http.delete(e).then(i=>{this.$swal({title:"產品已經刪除囉!!",showClass:{popup:"animate__animated animate__fadeInDown"},hideClass:{popup:"animate__animated animate__fadeOutUp"}}),this.$refs.deleteProductModal.hide(),this.getProducts()}).catch(i=>{alert(i.response.data.message)})}},mounted(){const l=document.cookie.replace(/(?:(?:^|.*;\s*)zack0313\s*=\s*([^;]*).*$)|^.*$/,"$1");this.$http.defaults.headers.common.Authorization=l,this.getProducts()}},Tt={class:"row justify-content-center"},Ct={class:"col-md-10"},$t={class:"text-end m-3"},Dt={class:"table align-middle text-center"},At=t("thead",null,[t("tr",null,[t("th",{width:"150"},"圖片"),t("th",{width:"130"},"分類"),t("th",{width:"130"},"產品名稱"),t("th",{width:"100"},"原價"),t("th",{width:"100"},"售價"),t("th",{width:"100"},"是否啟用"),t("th",{width:"120"},"編輯")])],-1),Nt={key:0,class:"text-success"},Ft={key:1,class:"text-muted"},Rt={class:"fs-3"},zt=["onClick"],St=["onClick"];function Bt(l,e,i,h,o,r){const s=_("VueLoading"),m=_("productModal"),v=_("deleteProductModal"),M=_("pagination");return d(),n(y,null,[f(s,{active:l.isLoading,color:o.color,loader:o.loader},null,8,["active","color","loader"]),t("div",Tt,[t("div",Ct,[t("div",$t,[t("button",{class:"btn btn-primary",type:"button",onClick:e[0]||(e[0]=c=>r.openModal("new"))},"新增產品")]),f(m,{ref:"productModal",product:o.tempProduct,isNew:o.isNew,onUpdateProduct:r.updateProduct},null,8,["product","isNew","onUpdateProduct"]),f(v,{ref:"deleteProductModal",product:o.tempProduct,onDelItem:r.removeProduct},null,8,["product","onDelItem"]),t("table",Dt,[At,t("tbody",null,[(d(!0),n(y,null,w(o.products,c=>(d(),n("tr",{key:c.id},[t("td",null,[t("div",{style:C([{height:"150px","background-size":"cover","background-position":"center"},{backgroundImage:`url(${c.imageUrl})`}])},null,4)]),t("th",null,g(c.category),1),t("td",null,g(c.title),1),t("td",null,g(l.$filters.currency(c.origin_price)),1),t("td",null,g(l.$filters.currency(c.price)),1),t("td",null,[c.is_enabled?(d(),n("span",Nt,"啟用")):(d(),n("span",Ft,"未啟用"))]),t("td",null,[t("div",Rt,[t("i",{class:"fa-solid fa-file-pen text-warning",style:{cursor:"pointer"},onClick:x=>r.openModal("edit",c)},null,8,zt),t("i",{class:"fa-solid fa-xmark ms-2 text-danger",style:{cursor:"pointer"},onClick:x=>r.openModal("delete",c)},null,8,St)])])]))),128))])]),f(M,{pages:o.page,"get-products":r.getProducts,onEmitPages:r.getProducts},null,8,["pages","get-products","onEmitPages"])])])],64)}const Jt=U(It,[["render",Bt]]);export{Jt as default};
