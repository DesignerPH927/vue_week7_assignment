import{_ as E,m as S,r as g,o as n,c as d,a as i,b as e,F as f,h as C,k as V,v as T,e as q,t as r,w as k,p as P,u as $,n as v}from"./index-af92421e.js";import{s as x}from"./statusStore-d902806f.js";const h=x(),{VITE_URL:u,VITE_PATH:m}={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"zack_p",BASE_URL:"/vue_week7_assignment/",MODE:"production",DEV:!1,PROD:!0},F={data(){return{color:"purple",loader:"dots",products:[],productId:"",cart:[],loadingItem:"",form:{user:{email:"",name:"",tel:"",address:""},message:""},coupon_code:"",id:""}},computed:{...S(x,["isLoading"])},methods:{getProducts(){h.isLoading=!0,this.$http.get(`${u}/api/${m}/products/all`).then(o=>{h.isLoading=!1,this.products=o.data.products}).catch(o=>{h.isLoading=!1,alert(o.response.data.message)})},addToCarts(o,s=1){const _={product_id:o.id,qty:s};this.$http.post(`${u}/api/${m}/cart`,{data:_}).then(y=>{this.$swal({icon:"success",title:"成功加入購物車"}),this.getCarts()}).catch(y=>{h.isLoading=!1,alert(y.response.data.message)})},addCouponCode(){const o={code:this.coupon_code};h.isLoading=!0,this.$http.post(`${u}/api/${m}/coupon`,{data:o}).then(()=>{h.isLoading=!1,this.coupon_code="",this.getCarts()}).catch(s=>{h.isLoading=!1,alert(s.response.data.message)})},getCarts(){this.$http.get(`${u}/api/${m}/cart`).then(o=>{this.cart=o.data.data}).catch(o=>{alert(o.response.data.message)})},setCartQty(o){this.loadingItem=o.id;const s={product_id:o.product_id,qty:o.qty};this.$http.put(`${u}/api/${m}/cart/${o.id}`,{data:s}).then(_=>{alert(_.data.message),this.getCarts(),this.loadingItem=""}).catch(_=>{alert(_.response.data.message)})},deleteCartItem(o){this.loadingItem=o.id,this.$http.delete(`${u}/api/${m}/cart/${o.id}`).then(s=>{alert(s.data.message),this.getCarts(),this.loadingItem=""}).catch(s=>{alert(s.response.data.message)})},deleteCartsItem(){this.$http.delete(`${u}/api/${m}/carts`).then(o=>{alert(o.data.message),this.getCarts()}).catch(o=>{alert(o.response.data.message)})},isPhone(o){return/^(09)[0-9]{8}$/.test(o)?!0:"需要正確的電話號碼"},onSubmit(){const o=this.form;this.$http.post(`${u}/api/${m}/order`,{data:o}).then(s=>{this.$refs.form.resetForm(),this.id=s.data.orderId,this.$router.push(`/user/checkPaid/${this.id}`)}).catch(s=>{alert(s.response.data.message)})}},mounted(){this.getProducts(),this.getCarts()}},D={class:"container"},z={class:"my-5"},B={class:"row"},M={class:"col-md-7"},N={class:"table align-middle"},R=e("thead",null,[e("tr",null,[e("th",null,"圖片"),e("th",null,"商品名稱"),e("th",null,"價格"),e("th")])],-1),A={style:{width:"200px"}},H={key:0,class:"h5 fw-bold"},O={key:1},Q={class:"h6 text-muted"},j={class:"h5 text-danger fw-bold"},X={class:"btn-group btn-group-sm"},G={key:0,class:"fa-solid fa-camera-rotate fa-flip"},J={key:1},K=["onClick"],W={key:0,i:"",class:"fa-solid fa-circle-plus fa-beat"},Y={key:1},Z={class:"col-md-5"},I={class:"input-group mb-3"},ee={class:"table align-middle"},te=e("thead",null,[e("tr",null,[e("th"),e("th",null,"品名"),e("th",null,"數量/單位"),e("th",null,"單價"),e("th",null,"小計")])],-1),se=["onClick","disabled"],oe={key:0,class:"fa-solid fa-triangle-exclamation fa-fade"},le={key:1},ae={style:{width:"150px"}},ne={class:"input-group"},de=["onUpdate:modelValue","onChange","disabled"],ie=["value"],re={class:"input-group-text"},ce={class:"text-end"},ue={class:"text-end"},me=e("td",{colspan:"4",class:"text-end fw-bold"},"總價",-1),he={class:"text-end"},_e=e("td",{colspan:"4",class:"text-end fw-bold text-success"},"折扣價",-1),pe={class:"text-end text-success"},ge={class:"text-end"},be=e("hr",null,null,-1),fe={class:"row justify-content-center"},ve={class:"col-md-4"},ye={class:"mb-3"},Ce=e("label",{for:"email",class:"form-label"},"Email",-1),Ve={class:"mb-3"},ke=e("label",{for:"name",class:"form-label"},"收件者姓名",-1),xe={class:"mb-3"},we=e("label",{for:"tel",class:"form-label"},"收件者電話",-1),Le={class:"mb-3"},Ue=e("label",{for:"address",class:"form-label"},"收件者地址",-1),Ee={class:"mb-3"},Se=e("label",{for:"message",class:"form-label"},"留言",-1),Te=e("div",{class:"mb-3 text-end"},[e("button",{class:"btn btn-danger",type:"submit"},"送出表單")],-1);function qe(o,s,_,y,l,c){const w=g("VueLoading"),L=g("router-link"),p=g("VueField"),b=g("error-message"),U=g("VueForm");return n(),d(f,null,[i(w,{active:o.isLoading,color:l.color,loader:l.loader},null,8,["active","color","loader"]),e("div",D,[e("div",z,[e("div",B,[e("div",M,[e("table",N,[R,e("tbody",null,[(n(!0),d(f,null,C(l.products,t=>(n(),d("tr",{key:t.id},[e("td",A,[e("div",{style:P([{height:"150px","background-size":"cover","background-position":"center"},{backgroundImage:`url(${t.imageUrl})`}])},null,4)]),e("td",null,r(t.category),1),e("td",null,[t.origin_price===t.price?(n(),d("div",H,"原價"+r(t.origin_price)+"元",1)):(n(),d("div",O,[e("del",Q," 原價"+r(t.origin_price)+"元 ",1),e("div",j," 現在只要"+r(t.price)+"元 ",1)]))]),e("td",null,[e("div",X,[i(L,{to:`/user/product/${t.id}`,type:"button",class:"btn btn-outline-primary"},{default:k(()=>[t.id===l.loadingItem?(n(),d("i",G)):(n(),d("span",J,"查看更多"))]),_:2},1032,["to"]),e("button",{type:"button",class:"btn btn-outline-danger",onClick:a=>c.addToCarts(t,o.qty)},[t.id===l.loadingItem?(n(),d("i",W)):(n(),d("span",Y,"加入購物車"))],8,K)])])]))),128))])])]),e("div",Z,[e("div",I,[V(e("input",{id:"coupon",type:"text",class:"form-control",placeholder:"請輸入優惠碼",min:"0","onUpdate:modelValue":s[0]||(s[0]=t=>l.coupon_code=t)},null,512),[[T,l.coupon_code]]),e("button",{class:"btn btn-secondary",type:"button",onClick:s[1]||(s[1]=q((...t)=>c.addCouponCode&&c.addCouponCode(...t),["prevent"]))},"套用優惠碼")]),e("table",ee,[te,e("tbody",null,[(n(!0),d(f,null,C(l.cart.carts,t=>(n(),d("tr",{key:t.id},[e("td",null,[e("button",{class:"btn btn-outline-danger",type:"button",onClick:a=>c.deleteCartItem(t),disabled:t.id===l.loadingItem},[t.id===l.loadingItem?(n(),d("i",oe)):(n(),d("span",le,"X"))],8,se)]),e("td",null,r(t.product.category),1),e("td",ae,[e("div",ne,[V(e("select",{name:"",id:"",class:"form-select","onUpdate:modelValue":a=>t.qty=a,onChange:a=>c.setCartQty(t),disabled:t.id===l.loadingItem},[(n(),d(f,null,C(20,a=>e("option",{value:a,key:a},r(a),9,ie)),64))],40,de),[[$,t.qty]]),e("div",re,r(t.product.unit),1)])]),e("td",ce,r(t.product.price),1),e("td",ue,r(t.total),1)]))),128))]),e("tfoot",null,[e("tr",null,[me,e("td",he,r(l.cart.total),1)]),e("tr",null,[_e,e("td",pe,r(l.cart.final_total),1)])])]),e("div",ge,[e("button",{class:"btn btn-outline-danger",type:"button",onClick:s[2]||(s[2]=(...t)=>c.deleteCartsItem&&c.deleteCartsItem(...t))},"刪除全購物車列表")])])])]),be,e("div",fe,[e("div",ve,[i(U,{onSubmit:c.onSubmit,ref:"form"},{default:k(({errors:t})=>[e("div",ye,[Ce,i(p,{id:"email",name:"email",type:"email",class:v(["form-control",{"is-invalid":t.email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:l.form.user.email,"onUpdate:modelValue":s[3]||(s[3]=a=>l.form.user.email=a)},null,8,["class","modelValue"]),i(b,{name:"email",class:"invalid-feedback"})]),e("div",Ve,[ke,i(p,{id:"name",name:"name",type:"text",class:v(["form-control",{"is-invalid":t.name}]),placeholder:"請輸入 name",rules:"required",modelValue:l.form.user.name,"onUpdate:modelValue":s[4]||(s[4]=a=>l.form.user.name=a)},null,8,["class","modelValue"]),i(b,{name:"name",class:"invalid-feedback"})]),e("div",xe,[we,i(p,{id:"tel",name:"telephone",type:"tel",class:v(["form-control",{"is-invalid":t.telephone}]),placeholder:"請輸入 telephone",rules:c.isPhone,modelValue:l.form.user.tel,"onUpdate:modelValue":s[5]||(s[5]=a=>l.form.user.tel=a)},null,8,["class","rules","modelValue"]),i(b,{name:"telephone",class:"invalid-feedback"})]),e("div",Le,[Ue,i(p,{id:"address",name:"address",type:"text",class:v(["form-control",{"is-invalid":t.address}]),placeholder:"請輸入 address",rules:"required",modelValue:l.form.user.address,"onUpdate:modelValue":s[6]||(s[6]=a=>l.form.user.address=a)},null,8,["class","modelValue"]),i(b,{name:"address",class:"invalid-feedback"})]),e("div",Ee,[Se,i(p,{id:"message",name:"message",class:"form-control",modelValue:l.form.message,"onUpdate:modelValue":s[7]||(s[7]=a=>l.form.message=a),rows:"5",as:"textarea"},null,8,["modelValue"])]),Te]),_:1},8,["onSubmit"])])])])],64)}const Fe=E(F,[["render",qe]]);export{Fe as default};
