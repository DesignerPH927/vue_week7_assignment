import{M as E,d as D}from"./DeleteModal-550a5879.js";import{_ as y,o as d,c as l,b as e,t as n,g as b,F as _,h as k,k as w,l as O,e as P,m as U,r as u,a as m,n as A}from"./index-af92421e.js";import{p as T}from"./PaginationComponent-35f24f56.js";import{s as $}from"./statusStore-d902806f.js";import"./component-functions-d7e525bd.js";const z={props:["orderItem"],inject:["emitter"],watch:{orderItem(){this.tempOrder=this.orderItem}},data(){return{Modal:{},tempOrder:{}}},mixins:[E]},B={class:"modal fade",id:"exampleModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"Modal"},R={class:"modal-dialog modal-xl"},S={class:"modal-content"},j=e("div",{class:"modal-header bg-dark text-white"},[e("h1",{class:"modal-title fs-5 text-warning",id:"exampleModalLabel"},"訂單細節"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),N={class:"modal-body"},q={class:"row"},F={class:"col-md-4"},H=e("h2",null,"用戶資料",-1),G={class:"table align-middle"},J={key:0},K=e("th",{width:"120"},"姓名",-1),Q=e("th",{width:"120"},"Email",-1),W=e("th",{width:"120"},"電話",-1),X=e("th",{width:"120"},"地址",-1),Y={class:"col-md-8"},Z=e("h2",null,"訂單細節",-1),I={class:"table align-middle mb-3"},ee=e("th",{width:"120"},"訂單編號",-1),te=e("th",{width:"120"},"下單時間",-1),se=e("th",{width:"120"},"付款時間",-1),oe={key:0},de={key:1},le=e("th",{width:"120"},"付款狀態",-1),ne={class:"fw-bold"},ie={key:0,class:"text-success"},ae={key:1,class:"text-danger"},re=e("th",{width:"120"},"總金額",-1),ce=e("h2",null,"選購商品",-1),he={class:"table align-middle"},_e={class:"form-check d-flex justify-content-end"},pe={for:"paid",class:"form-check-label fw-bold"},ue={key:0,class:"text-success"},me={key:1,class:"text-danger"},fe={class:"modal-footer"},ge=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"取消",-1);function be(s,o,p,v,t,c){return d(),l("div",B,[e("div",R,[e("div",S,[j,e("div",N,[e("div",q,[e("div",F,[H,e("table",G,[t.tempOrder.user?(d(),l("tbody",J,[e("tr",null,[K,e("td",null,n(t.tempOrder.user.name),1)]),e("tr",null,[Q,e("td",null,n(t.tempOrder.user.email),1)]),e("tr",null,[W,e("td",null,n(t.tempOrder.user.tel),1)]),e("tr",null,[X,e("td",null,n(t.tempOrder.user.address),1)])])):b("",!0)])]),e("div",Y,[Z,e("table",I,[e("tbody",null,[e("tr",null,[ee,e("td",null,n(t.tempOrder.id),1)]),e("tr",null,[te,e("td",null,n(s.$filters.date(t.tempOrder.create_at)),1)]),e("tr",null,[se,e("td",null,[t.tempOrder.paid_date?(d(),l("span",oe,n(s.$filters.date(t.tempOrder.paid_date)),1)):(d(),l("span",de,"時間不正確"))])]),e("tr",null,[le,e("td",ne,[t.tempOrder.is_paid?(d(),l("span",ie,"已付清")):(d(),l("span",ae,"未付清"))])]),e("tr",null,[re,e("td",null,n(s.$filters.currency(t.tempOrder.total)),1)])])]),ce,e("table",he,[e("tbody",null,[(d(!0),l(_,null,k(t.tempOrder.products,r=>(d(),l("tr",{key:r.id},[e("th",null,n(r.product.title),1),e("td",null,n(r.qty)+"/"+n(r.product.unit),1),e("td",null,n(r.total),1)]))),128))])]),e("div",_e,[w(e("input",{type:"checkbox",class:"form-check-input me-1",id:"paid","onUpdate:modelValue":o[0]||(o[0]=r=>t.tempOrder.is_paid=r)},null,512),[[O,t.tempOrder.is_paid]]),e("label",pe,[t.tempOrder.is_paid?(d(),l("span",ue,"已付款")):(d(),l("span",me,"未付款"))])])])])]),e("div",fe,[ge,e("button",{type:"button",class:"btn btn-primary",onClick:o[1]||(o[1]=P(r=>s.$emit("confirm",t.tempOrder),["prevent"]))},"修改付款狀態")])])])],512)}const ke=y(z,[["render",be]]),a=$(),{VITE_URL:f,VITE_PATH:g}={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"zack_p",BASE_URL:"/vue_week7_assignment/",MODE:"production",DEV:!1,PROD:!0},ye={data(){return{color:"purple",loader:"dots",orders:[],tempOrder:{},page:{}}},computed:{...U($,["isLoading"])},components:{orderModal:ke,deleteModal:D,pagination:T},methods:{getOrders(s=1){a.isLoading=!0,this.$http.get(`${f}/api/${g}/admin/orders/?page=${s}`).then(o=>{this.orders=o.data.orders,this.page=o.data.pagination,a.isLoading=!1}).catch(o=>{a.isLoading=!1,alert(o.response.data.message)})},openModal(s,o){a.isLoading=!0,s==="edit"?(this.tempOrder={...o},this.$refs.orderModal.show(),a.isLoading=!1):(this.tempOrder={...o},this.$refs.deleteModal.show(),a.isLoading=!1)},updatePaid(s){const o={is_paid:s.is_paid};a.isLoading=!0,this.$http.put(`${f}/api/${g}/admin/order/${s.id}`,{data:o}).then(p=>{a.isLoading=!0,this.$refs.orderModal.hide(),this.getOrders()}).catch(p=>{a.isLoading=!1,alert(p.response.data.message)})},delOrderItem(s){this.$http.delete(`${f}/api/${g}/admin/order/${s.id}`).then(()=>{this.$swal({title:"產品已經刪除囉!!",showClass:{popup:"animate__animated animate__fadeInDown"},hideClass:{popup:"animate__animated animate__fadeOutUp"}}),this.$refs.deleteModal.hide(),this.getOrders()}).catch(o=>{alert(o.response.data.message)})},removeAll(){a.isLoading=!0,this.$http.delete(`${f}/api/${g}/admin/orders/all`).then(()=>{a.isLoading=!1,this.$swal({title:"產品已經刪除囉!!",showClass:{popup:"animate__animated animate__fadeInDown"},hideClass:{popup:"animate__animated animate__fadeOutUp"}}),this.getOrders()}).catch(s=>{alert(s.response.data.message)})}},mounted(){const s=document.cookie.replace(/(?:(?:^|.*;\s*)zack0313\s*=\s*([^;]*).*$)|^.*$/,"$1");this.$http.defaults.headers.common.Authorization=s,this.getOrders()}},we={class:"m-3"},Oe={class:"row justify-content-center"},$e={class:"col-md-10"},ve={class:"text-end m-3"},Me={class:"table align-middle"},xe=e("thead",null,[e("tr",null,[e("th",{width:"150"},"購買時間"),e("th",null,"Email"),e("th",null,"購買款項"),e("th",{width:"120"},"應付金額"),e("th",{width:"150"},"是否付款"),e("th",{width:"150"},"編輯")])],-1),Ce=["textContent"],Le={class:"list-unstyled"},Ve={class:"form-check form-switch"},Ee=["id","onUpdate:modelValue","onChange"],De=["for"],Pe={key:0,class:"text-success"},Ue={key:1,class:"text-danger"},Ae={class:"fs-3"},Te=["onClick"],ze=["onClick"];function Be(s,o,p,v,t,c){const r=u("VueLoading"),M=u("pagination"),x=u("orderModal"),C=u("deleteModal");return d(),l(_,null,[m(r,{active:s.isLoading,color:t.color,loader:t.loader},null,8,["active","color","loader"]),e("div",we,[e("div",Oe,[e("div",$e,[e("div",ve,[e("button",{class:"btn btn-danger",type:"button",onClick:o[0]||(o[0]=i=>c.removeAll())},"刪除全部訂單")]),e("table",Me,[xe,e("tbody",null,[(d(!0),l(_,null,k(t.orders,(i,L)=>(d(),l(_,{key:L},[t.orders.length?(d(),l("tr",{key:0,class:A({"text-secondary":!i.is_paid})},[e("td",null,n(s.$filters.date(i.create_at)),1),e("td",null,[i.user?(d(),l("span",{key:0,textContent:n(i.user.email)},null,8,Ce)):b("",!0)]),e("td",null,[e("ul",Le,[(d(!0),l(_,null,k(i.products,(h,V)=>(d(),l("li",{key:V},n(h.product.title)+"，數量："+n(h.qty)+" "+n(h.product.unit),1))),128))])]),e("td",null,n(s.$filters.currency(i.total)),1),e("td",null,[e("div",Ve,[w(e("input",{class:"form-check-input",type:"checkbox",role:"switch",id:`${i.id}`,"onUpdate:modelValue":h=>i.is_paid=h,onChange:h=>c.updatePaid(i)},null,40,Ee),[[O,i.is_paid]]),e("label",{class:"form-check-label",for:`${i.id}`},[i.is_paid?(d(),l("span",Pe,"已付款")):(d(),l("span",Ue,"未付款"))],8,De)])]),e("td",null,[e("div",Ae,[e("i",{class:"fa-solid fa-folder-open text-warning",style:{cursor:"pointer"},onClick:h=>c.openModal("edit",i)},null,8,Te),e("i",{class:"fa-solid fa-xmark ms-2 text-danger",style:{cursor:"pointer"},onClick:h=>c.openModal("delete",i)},null,8,ze)])])],2)):b("",!0)],64))),128))])]),m(M,{pages:t.page,onEmitPages:c.getOrders},null,8,["pages","onEmitPages"])])])]),m(x,{ref:"orderModal","order-item":t.tempOrder,onConfirm:c.updatePaid},null,8,["order-item","onConfirm"]),m(C,{ref:"deleteModal",onDelItem:c.delOrderItem},null,8,["onDelItem"])],64)}const Fe=y(ye,[["render",Be]]);export{Fe as default};
