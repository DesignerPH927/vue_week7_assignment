import{M as x,d as L}from"./DeleteModal-550a5879.js";import{_ as w,o as l,c as a,b as e,k as u,v as r,l as V,e as M,m as D,r as f,a as b,F as v,h as U,t as C}from"./index-af92421e.js";import{s as g}from"./statusStore-d902806f.js";import"./component-functions-d7e525bd.js";const T={props:["coupon","isNew"],data(){return{Modal:{},due_date:"",tempCoupon:{}}},watch:{coupon(){this.tempCoupon=this.coupon;const t=new Date(this.tempCoupon.due_date*1e3).toISOString().split("T");[this.due_date]=t},due_date(){this.tempCoupon.due_date=Math.floor(new Date(this.due_date)/1e3)}},mixins:[x]},E={class:"modal fade",id:"exampleModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"Modal"},N={class:"modal-dialog"},S={class:"modal-content border-0"},A={class:"modal-header bg-dark"},B={class:"modal-title fs-5",id:"exampleModalLabel"},I={key:0,class:"text-info"},O={key:1,class:"text-warning"},R=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),z={class:"modal-body"},P={class:"mb-3"},F=e("label",{for:"title",class:"form-label"},"標題",-1),H={class:"mb-3"},j=e("label",{for:"coupon",class:"form-label"},"優惠碼",-1),q={class:"mb-3"},G=e("label",{for:"date",class:"form-label"},"到期日",-1),J={class:"mb-3"},K=e("label",{for:"percent",class:"form-label"},"折扣百分比",-1),Q={class:"mb-3"},W={class:"form-check"},X=e("label",{for:"enabled",class:"form-check-label"},"是否啟用",-1),Y={class:"modal-footer"},Z=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消",-1),ee={key:0},oe={key:1};function te(t,o,i,_,s,p){return l(),a("div",E,[e("div",N,[e("div",S,[e("div",A,[e("h1",B,[i.isNew?(l(),a("span",I,"新增優惠卷")):(l(),a("span",O,"編輯優惠卷"))]),R]),e("div",z,[e("div",P,[F,u(e("input",{type:"text",class:"form-control",placeholder:"請輸入標題",id:"title","onUpdate:modelValue":o[0]||(o[0]=n=>s.tempCoupon.title=n)},null,512),[[r,s.tempCoupon.title]])]),e("div",H,[j,u(e("input",{type:"text",class:"form-control",placeholder:"請輸入優惠碼",id:"coupon","onUpdate:modelValue":o[1]||(o[1]=n=>s.tempCoupon.code=n)},null,512),[[r,s.tempCoupon.code]])]),e("div",q,[G,u(e("input",{type:"date",class:"form-control",id:"date","onUpdate:modelValue":o[2]||(o[2]=n=>s.due_date=n)},null,512),[[r,s.due_date]])]),e("div",J,[K,u(e("input",{type:"number",class:"form-control",min:"0",placeholder:"請輸入折扣百分比",id:"percent","onUpdate:modelValue":o[3]||(o[3]=n=>s.tempCoupon.percent=n)},null,512),[[r,s.tempCoupon.percent,void 0,{number:!0}]])]),e("div",Q,[e("div",W,[u(e("input",{type:"checkbox",class:"form-check-input",id:"enabled","onUpdate:modelValue":o[4]||(o[4]=n=>s.tempCoupon.is_enabled=n),"true-value":1,"false-value":0},null,512),[[V,s.tempCoupon.is_enabled]]),X])])]),e("div",Y,[Z,e("button",{type:"button",class:"btn btn-outline-primary",onClick:o[5]||(o[5]=M(n=>t.$emit("update-coupon",s.tempCoupon),["prevent"]))},[i.isNew?(l(),a("span",ee,"新增優惠卷")):(l(),a("span",oe,"編輯優惠碼"))])])])])],512)}const se=w(T,[["render",te]]),c=g(),{VITE_URL:m,VITE_PATH:h}={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"zack_p",BASE_URL:"/vue_week7_assignment/",MODE:"production",DEV:!1,PROD:!0},ne={data(){return{color:"purple",loader:"dots",isNew:!1,coupons:{},tempCoupon:{}}},computed:{...D(g,["isLoading"])},components:{couponModal:se,deleteModal:L},methods:{getCoupons(){c.isLoading=!0,this.$http.get(`${m}/api/${h}/admin/coupons`).then(t=>{c.isLoading=!1,this.coupons=t.data.coupons}).catch(t=>{c.isLoading=!1,alert(t.response.data.message)})},openModal(t,o){t==="new"?(this.tempCoupon={due_date:new Date().getTime()/1e3},this.isNew=!0,this.$refs.couponModal.show()):t==="edit"?(this.tempCoupon={...o},this.isNew=!1,this.$refs.couponModal.show()):t==="delete"&&(this.tempCoupon={...o},this.$refs.deleteModal.show())},updateCoupon(t){let o=`${m}/api/${h}/admin/coupon`,i="post";this.isNew||(o=`${m}/api/${h}/admin/coupon/${t.id}`,i="put"),c.isLoading=!0,this.$http[i](o,{data:t}).then(()=>{c.isLoading=!1,this.$refs.couponModal.hide(),this.getCoupons()}).catch(_=>{c.isLoading=!1,this.$refs.couponModal.show(),alert(_.response.data.message)})},delCouponItem(t){this.$http.delete(`${m}/api/${h}/admin/coupon/${t.id}`).then(()=>{this.$swal({title:"產品已經刪除囉!!",showClass:{popup:"animate__animated animate__fadeInDown"},hideClass:{popup:"animate__animated animate__fadeOutUp"}}),this.$refs.deleteModal.hide(),this.getCoupons()}).catch(o=>{alert(o.response.data.message)})}},mounted(){const t=document.cookie.replace(/(?:(?:^|.*;\s*)zack0313\s*=\s*([^;]*).*$)|^.*$/,"$1");this.$http.defaults.headers.common.Authorization=t,this.getCoupons()}},le={class:"row justify-content-center"},ae={class:"col-md-10"},de={class:"m-3 text-end"},ie={class:"table align-middle"},pe=e("thead",null,[e("tr",null,[e("th",{width:"150"},"名稱"),e("th",{width:"200"},"折扣百分比"),e("th",{width:"150"},"到期日"),e("th",{width:"150"},"是否啟用"),e("th",{width:"150"},"編輯")])],-1),ce={key:0,class:"text-success"},ue={key:1,class:"text-danger"},re={class:"fs-3"},me=["onClick"],he=["onClick"];function _e(t,o,i,_,s,p){const n=f("VueLoading"),k=f("couponModal"),y=f("deleteModal");return l(),a(v,null,[b(n,{active:t.isLoading,color:s.color,loader:s.loader},null,8,["active","color","loader"]),e("div",le,[e("div",ae,[e("div",de,[e("button",{class:"btn btn-primary",type:"button",onClick:o[0]||(o[0]=M(d=>p.openModal("new"),["prevent"]))},"建立新優惠卷")]),e("table",ie,[pe,e("tbody",null,[(l(!0),a(v,null,U(s.coupons,d=>(l(),a("tr",{key:d.id},[e("td",null,C(d.title),1),e("td",null,C(d.percent)+"%",1),e("td",null,C(t.$filters.date(d.due_date)),1),e("td",null,[d.is_enabled?(l(),a("span",ce,"啟用")):(l(),a("span",ue,"未啟用"))]),e("td",null,[e("div",re,[e("i",{class:"fa-solid fa-file-pen text-warning",style:{cursor:"pointer"},onClick:$=>p.openModal("edit",d)},null,8,me),e("i",{class:"fa-solid fa-xmark ms-2 text-danger",style:{cursor:"pointer"},onClick:$=>p.openModal("delete",d)},null,8,he)])])]))),128))])])])]),b(k,{ref:"couponModal",coupon:s.tempCoupon,"is-new":s.isNew,onUpdateCoupon:p.updateCoupon},null,8,["coupon","is-new","onUpdateCoupon"]),b(y,{ref:"deleteModal",product:s.tempCoupon,onDelItem:p.delCouponItem},null,8,["product","onDelItem"])],64)}const we=w(ne,[["render",_e]]);export{we as default};
